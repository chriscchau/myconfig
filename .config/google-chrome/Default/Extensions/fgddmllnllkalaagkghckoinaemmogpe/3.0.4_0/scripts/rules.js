!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=592)}({16:function(e,t,r){"use strict";!function(e){function t(e,t){}function r(e){s=e}function n(){return s}function i(e,t){var r=new XMLHttpRequest;if(r.open("GET",chrome.extension.getURL(e),!1),r.send(null),4===r.readyState)return"xml"===t?r.responseXML:"json"===t?JSON.parse(r.responseText):r.responseText}function o(e){var t=new Uint8Array(e),r="",n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r+=String.fromCharCode(u)}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}var a=5,s=4;Object.assign(e,{VERB:1,DBUG:2,INFO:3,NOTE:4,WARN:a,log:t,setDefaultLogLevel:r,getDefaultLogLevel:n,loadExtensionFile:i,ArrayBufferToString:o})}(t)},39:function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){function t(e,t){"^http:"===e&&"https:"===t?(this.to=g,this.from_c=v):(this.to=t,this.from_c=new RegExp(e))}function a(e){this.pattern_c=new RegExp(e)}function s(e,t){this.host_c=".+"===e?d:new RegExp(e),this.name_c=".+"===t?d:new RegExp(t)}function u(e,t,r){this.name=e,this.rules=[],this.exclusions=null,this.cookierules=null,this.active=t,this.default_state=t,this.note=r}function l(){return this.targets=new Map,this.ruleCache=new Map,this.cookieHostCache=new Map,this.ruleActiveStates={},this.USER_RULE_KEY="userRules",this}var c,h=r(16),f={enableMixedRulesets:!1,domainBlacklist:new Set},v=/^http:/,g="https:",d=/.+/,m=Object.create(null,(c={},o(c,Symbol.iterator,{value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})}),o(c,"size",{value:0}),c));u.prototype={apply:function(e){var t=null;if(null!==this.exclusions){var r=!0,n=!1,i=void 0;try{for(var o,a=this.exclusions[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){if(o.value.pattern_c.test(e))return h.log(h.DBUG,"excluded uri "+e),null}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}var s=!0,u=!1,l=void 0;try{for(var c,f=this.rules[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var v=c.value;if((t=e.replace(v.from_c,v.to))!=e)return t}}catch(e){u=!0,l=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}return null},isEquivalentTo:function(e){if(this.name!=e.name||this.note!=e.note||this.state!=e.state||this.default_state!=e.default_state)return!1;try{var t=this.exclusions.length}catch(e){var t=0}try{var r=e.exclusions.length}catch(e){var r=0}try{var n=this.rules.length}catch(e){var n=0}try{var i=e.rules.length}catch(e){var i=0}if(t!=r||n!=i)return!1;if(t>0)for(var o=0;o<this.exclusions.length;o++)if(this.exclusions[o].pattern_c!=e.exclusions[o].pattern_c)return!1;if(n>0)for(var a=0;a<this.rules.length;a++)if(this.rules[a].to!=e.rules[a].to)return!1;return!0}},l.prototype={loadFromBrowserStorage:function(){function e(e,r){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.store=t,e.next=3,this.store.get_promise("ruleActiveStates",{});case 3:return this.ruleActiveStates=e.sent,e.next=6,r(this);case 6:return this.loadStoredUserRules(),e.next=9,this.addStoredCustomRulesets();case 9:case"end":return e.stop()}},e,this)}));return e}(),addFromXml:function(e){var t=e.getElementsByTagName("ruleset"),r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;try{this.parseOneXmlRuleset(s)}catch(e){h.log(h.WARN,"Error processing ruleset:"+e)}}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}},addFromJson:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;try{this.parseOneJsonRuleset(a)}catch(e){h.log(h.WARN,"Error processing ruleset:"+e)}}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}},parseOneJsonRuleset:function(e){var r=!0,n="",i=e.default_off;i&&(r=!1,n+=i+"\n");var o=e.platform;o&&(r=!1,"mixedcontent"==o&&f.enableMixedRulesets&&(r=!0),n+="Platform(s): "+o+"\n");var l=new u(e.name,r,n.trim());l.name in this.ruleActiveStates&&(l.active=this.ruleActiveStates[l.name]);var c=e.rule,h=!0,v=!1,g=void 0;try{for(var d,m=c[Symbol.iterator]();!(h=(d=m.next()).done);h=!0){var y=d.value;null!=y.from&&null!=y.to&&l.rules.push(new t(y.from,y.to))}}catch(e){v=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(v)throw g}}var p=e.exclusion;if(null!=p){var x=!0,R=!1,w=void 0;try{for(var S,b=p[Symbol.iterator]();!(x=(S=b.next()).done);x=!0){var k=S.value;null!=k&&(l.exclusions||(l.exclusions=[]),l.exclusions.push(new a(k)))}}catch(e){R=!0,w=e}finally{try{!x&&b.return&&b.return()}finally{if(R)throw w}}}var A=e.securecookie;if(null!=A){var _=!0,C=!1,E=void 0;try{for(var U,O=A[Symbol.iterator]();!(_=(U=O.next()).done);_=!0){var N=U.value;null!=N.host&&null!=N.name&&(l.cookierules||(l.cookierules=[]),l.cookierules.push(new s(N.host,N.name)))}}catch(e){C=!0,E=e}finally{try{!_&&O.return&&O.return()}finally{if(C)throw E}}}var B=e.target,T=!0,F=!1,M=void 0;try{for(var D,I=B[Symbol.iterator]();!(T=(D=I.next()).done);T=!0){var L=D.value;null!=L&&(this.targets.has(L)||this.targets.set(L,[]),this.targets.get(L).push(l))}}catch(e){F=!0,M=e}finally{try{!T&&I.return&&I.return()}finally{if(F)throw M}}},addUserRule:function(e){h.log(h.INFO,"adding new user rule for "+JSON.stringify(e));var r=new u(e.host,!0,"user rule"),n=new t(e.urlMatcher,e.redirectTo);return r.rules.push(n),this.targets.has(e.host)||this.targets.set(e.host,[]),this.ruleCache.delete(e.host),this.targets.get(e.host).push(r),r.name in this.ruleActiveStates&&(r.active=this.ruleActiveStates[r.name]),h.log(h.INFO,"done adding rule"),!0},removeUserRule:function(e){h.log(h.INFO,"removing user rule for "+JSON.stringify(e)),this.ruleCache.delete(e.name);var t=this.targets.get(e.name).filter(function(t){return!t.isEquivalentTo(e)});return this.targets.set(e.name,t),0==this.targets.get(e.name).length&&this.targets.delete(e.name),h.log(h.INFO,"done removing rule"),!0},getStoredUserRules:function(){function e(){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.store.get_promise(this.USER_RULE_KEY,[]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return e}(),loadStoredUserRules:function(){function e(){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(){var t,r,n,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStoredUserRules();case 2:for(t=e.sent,r=!0,n=!1,i=void 0,e.prev=6,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)s=a.value,this.addUserRule(s);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),n=!0,i=e.t0;case 14:e.prev=14,e.prev=15,!r&&o.return&&o.return();case 17:if(e.prev=17,!n){e.next=20;break}throw i;case 20:return e.finish(17);case 21:return e.finish(14);case 22:h.log(h.INFO,"loaded "+t.length+" stored user rules");case 23:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return e}(),addNewRuleAndStore:function(){function e(e){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.addUserRule(t)){e.next=7;break}return e.next=3,this.getStoredUserRules();case 3:return r=e.sent,r.push(t),e.next=7,this.store.set_promise(this.USER_RULE_KEY,r);case 7:case"end":return e.stop()}},e,this)}));return e}(),removeRuleAndStore:function(){function e(e){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.removeUserRule(t)){e.next=7;break}return e.next=3,this.getStoredUserRules();case 3:return r=e.sent,r=r.filter(function(e){return!(e.host==t.name&&e.redirectTo==t.rules[0].to)}),e.next=7,this.store.set_promise(this.USER_RULE_KEY,r);case 7:case"end":return e.stop()}},e,this)}));return e}(),addStoredCustomRulesets:function(){var e=this;return new Promise(function(t){e.store.get({legacy_custom_rulesets:[],debugging_rulesets:""},function(r){e.loadCustomRulesets(r.legacy_custom_rulesets),e.loadCustomRuleset("<root>"+r.debugging_rulesets+"</root>"),t()})})},loadCustomRulesets:function(e){var t=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.loadCustomRuleset(a)}}catch(e){r=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(r)throw n}}},loadCustomRuleset:function(e){this.addFromXml((new DOMParser).parseFromString(e,"text/xml"))},setRuleActiveState:function(){function e(e,r){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0==r?delete this.ruleActiveStates[t]:this.ruleActiveStates[t]=r,e.next=3,this.store.set_promise("ruleActiveStates",this.ruleActiveStates);case 3:case"end":return e.stop()}},e,this)}));return e}(),parseOneXmlRuleset:function(e){var r=!0,n="",i=e.getAttribute("default_off");i&&(r=!1,n+=i+"\n");var o=e.getAttribute("platform");o&&(r=!1,"mixedcontent"==o&&f.enableMixedRulesets&&(r=!0),n+="Platform(s): "+o+"\n");var l=new u(e.getAttribute("name"),r,n.trim());l.name in this.ruleActiveStates&&(l.active="true"==this.ruleActiveStates[l.name]);var c=e.getElementsByTagName("rule"),h=!0,v=!1,g=void 0;try{for(var d,m=c[Symbol.iterator]();!(h=(d=m.next()).done);h=!0){var y=d.value;l.rules.push(new t(y.getAttribute("from"),y.getAttribute("to")))}}catch(e){v=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(v)throw g}}var p=e.getElementsByTagName("exclusion");if(p.length>0){l.exclusions=[];var x=!0,R=!1,w=void 0;try{for(var S,b=p[Symbol.iterator]();!(x=(S=b.next()).done);x=!0){var k=S.value;l.exclusions.push(new a(k.getAttribute("pattern")))}}catch(e){R=!0,w=e}finally{try{!x&&b.return&&b.return()}finally{if(R)throw w}}}var A=e.getElementsByTagName("securecookie");if(A.length>0){l.cookierules=[];var _=!0,C=!1,E=void 0;try{for(var U,O=A[Symbol.iterator]();!(_=(U=O.next()).done);_=!0){var N=U.value;l.cookierules.push(new s(N.getAttribute("host"),N.getAttribute("name")))}}catch(e){C=!0,E=e}finally{try{!_&&O.return&&O.return()}finally{if(C)throw E}}}var B=e.getElementsByTagName("target"),T=!0,F=!1,M=void 0;try{for(var D,I=B[Symbol.iterator]();!(T=(D=I.next()).done);T=!0){var L=D.value,j=L.getAttribute("host");this.targets.has(j)||this.targets.set(j,[]),this.targets.get(j).push(l)}}catch(e){F=!0,M=e}finally{try{!T&&I.return&&I.return()}finally{if(F)throw M}}},potentiallyApplicableRulesets:function(e){if(this.ruleCache.has(e)){var t=this.ruleCache.get(e);return h.log(h.DBUG,"Ruleset cache hit for "+e+" items:"+t.size),t}h.log(h.DBUG,"Ruleset cache miss for "+e);var r=this.targets.has(e)?new Set([].concat(n(this.targets.get(e)))):new Set;if(e.length<=0||e.length>255||-1!=e.indexOf(".."))return h.log(h.WARN,"Malformed host passed to potentiallyApplicableRulesets: "+e),m;for(var i=e.split("."),o=0;o<i.length;o++){var a=i[o];i[o]="*",r=this.targets.has(i.join("."))?new Set([].concat(n(r),n(this.targets.get(i.join("."))))):r,i[o]=a}for(var s=2;s<=i.length-2;s++){var u="*."+i.slice(s,i.length).join(".");r=this.targets.has(u)?new Set([].concat(n(r),n(this.targets.get(u)))):r}return r.delete(void 0),h.log(h.DBUG,"Applicable rules for "+e+":"),0==r.size?(h.log(h.DBUG,"  None"),r=m):r.forEach(function(e){return h.log(h.DBUG,"  "+e.name)}),this.ruleCache.set(e,r),this.ruleCache.size>1e3&&this.ruleCache.delete(this.ruleCache.keys().next().value),r},shouldSecureCookie:function(e){for(var t=e.domain;"."==t.charAt(0);)t=t.slice(1);if(!this.safeToSecureCookie(t))return null;var r=this.potentiallyApplicableRulesets(t),n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;if(null!==u.cookierules&&u.active){var l=!0,c=!1,h=void 0;try{for(var f,v=u.cookierules[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var g=f.value,d=g;if(d.host_c.test(e.domain)&&d.name_c.test(e.name))return u}}catch(e){c=!0,h=e}finally{try{!l&&v.return&&v.return()}finally{if(c)throw h}}}}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return null},safeToSecureCookie:function(e){if(f.domainBlacklist.has(e))return h.log(h.INFO,"cookies for "+e+"blacklisted"),!1;var t=this.cookieHostCache.get(e);if(void 0!==t)return h.log(h.DBUG,"Cookie host cache hit for "+e),t;h.log(h.DBUG,"Cookie host cache miss for "+e);var r="/"+Math.random().toString(),n="http://"+e+r+r;this.cookieHostCache.size>250&&this.cookieHostCache.delete(this.cookieHostCache.keys().next().value),h.log(h.INFO,"Testing securecookie applicability with "+n);var i=this.potentiallyApplicableRulesets(e),o=!0,a=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(c.active&&c.apply(n))return h.log(h.INFO,"Cookie domain could be secured."),this.cookieHostCache.set(e,!0),!0}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return h.log(h.INFO,"Cookie domain could NOT be secured."),this.cookieHostCache.set(e,!1),!1},rewriteURI:function(e,t){var r=null,n=this.potentiallyApplicableRulesets(t),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.active&&(r=l.apply(e)))return r}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return null}},Object.assign(e,{nullIterable:m,settings:f,trivial_rule_to:g,trivial_rule_from_c:v,Exclusion:a,Rule:t,RuleSet:u,RuleSets:l})}(t)},592:function(e,t,r){e.exports=r(39)}});