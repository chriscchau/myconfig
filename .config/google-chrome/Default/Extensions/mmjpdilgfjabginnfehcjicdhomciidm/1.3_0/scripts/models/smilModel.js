Readium.Models.SmilModel=function(){function h(a){m(a);a.childNodes.length>0&&$.each(a.childNodes,function(a,b){h(b)})}function m(a){a.toString=function(){for(var a="<"+this.nodeName,b=0;b<this.attributes.length;b++)a+=" "+this.attributes.item(b).nodeName+"="+this.attributes.item(b).nodeValue;a+=">";return a};if(g.hasOwnProperty(a.tagName))a.render=g[a.tagName];if(i.hasOwnProperty(a.tagName))a.notifyChildDone=i[a.tagName];n(a)}function n(a){a.tagName=="audio"&&($(a).attr("src")!=void 0&&$(a).attr("src",
o($(a).attr("src"),j)),$(a).attr("clipBegin")!=void 0?$(a).attr("clipBegin",k($(a).attr("clipBegin"))):$(a).attr("clipBegin",0),$(a).attr("clipEnd")!=void 0?$(a).attr("clipEnd",k($(a).attr("clipEnd"))):$(a).attr("clipEnd",9999999))}function o(a,c){if(a.indexOf("://")!=-1)return a;var b=c;c[c.length-1]!="/"&&(b=c.substr(0,c.lastIndexOf("/")+1));return b+a}function k(a){var c=0,b=0,d=0;a.indexOf("min")!=-1?b=parseFloat(a.substr(0,a.indexOf("min"))):a.indexOf("ms")!=-1?d=parseFloat(a.substr(0,a.indexOf("ms")))/
1E3:a.indexOf("s")!=-1?d=parseFloat(a.substr(0,a.indexOf("s"))):a.indexOf("h")!=-1?c=parseFloat(a.substr(0,a.indexOf("h"))):(arr=a.split(":"),d=parseFloat(arr.pop()),arr.length>0&&(b=parseFloat(arr.pop()),arr.length>0&&(c=parseFloat(arr.pop()))));return c*3600+b*60+d}NodeLogic={parRender:function(){$.each(this.childNodes,function(a,c){c.hasOwnProperty("render")&&c.render()})},seqRender:function(a){a==null?this.firstElementChild.render():a.render()},audioNotifyChildDone:function(){this.parentNode.notifyChildDone(this)},
parNotifyChildDone:function(a){a.tagName=="audio"&&this.parentNode.notifyChildDone(this)},seqNotifyChildDone:function(a){a.nextElementSibling==null?this==e?l():this.parentNode.notifyChildDone(this):this.render(a.nextElementSibling)}};var g={seq:NodeLogic.seqRender,par:NodeLogic.parRender,body:NodeLogic.seqRender},i={seq:NodeLogic.seqNotifyChildDone,par:NodeLogic.parNotifyChildDone,body:NodeLogic.seqNotifyChildDone,audio:NodeLogic.audioNotifyChildDone,text:function(){}},j=null,l=null,e=null;this.addRenderers=
function(a){g=$.extend(g,a)};this.setUrl=function(a){j=a};this.setNotifySmilDone=function(a){l=a};this.build=function(a){e=a;h(a)};this.render=function(a){a==null||a==void 0||a==e?e.render(null):(this.peekNextAudio(a).isJumpTarget=!0,a.parentNode.render(a))};this.findNodeByAttrValue=function(a,c,b){if(e==null)return null;var d=null,f=c;if(f=="src"||f=="epub:textref"){f=="epub:textref"&&(f="epub\\:textref");var g=b.substr(b.lastIndexOf("/")+1),a=$(e).find(a+"["+f+"]");b==""?d=a[0]:a.each(function(){var a=
$(this).attr(f);if(a!=void 0&&(a=a.substr(a.lastIndexOf("/")+1),a===g))return d=this,!1})}else f!=""&&(a+="["+f,b!=""&&(a+="='"+b+"'"),a+="]"),d=$(e).find(a),d=d.length==0?null:d[0];return d};this.peekNextAudio=function(a){if(a.tagName=="par")return $(a).find("audio")[0];if(a.tagName=="text")return $(a.parentNode).find("audio")[0];for(a=a.parentNode;a.nextElementSibling==null;)if(a=a.parentNode,a==e)return null;return $(a.nextElementSibling).find("audio")[0]}};
