Readium.Views.FixedPaginationView=Readium.Views.PaginationViewBase.extend({initialize:function(a){Readium.Views.PaginationViewBase.prototype.initialize.call(this,a);this.model.get("spine_position");this.model.on("FXL_goToPage",this.spinePositionChangeHandler,this);this.model.on("change:two_up",this.setUpMode,this);this.model.on("change:meta_size",this.setContainerSize,this)},render:function(){$("body").addClass("apple-fixed-layout");this.$("#container").html("");this.setContainerSize();this.setUpMode();
for(var a=this,c=1,b=this.findPrerenderStart(),d=[],e=this.model.get("spine_position");this.shouldPreRender(this.model.getCurrentSection(b));)this.addPage(this.model.getCurrentSection(b),c),d.push(e+b),c+=1,b+=1;b=d.indexOf(e)+1;this.pages.set("num_pages",c-1);this.pages.goToPage(b);setTimeout(function(){a.setContainerSize()},15);this.showCurrentPages();return d},getPageBody:function(a){a=$("#page-"+a.toString()+" iframe");return a.length>0?(a=a.contents()[0].documentElement,$(a).find("body")):null},
indicateMoIsPlaying:function(){(new Readium.Models.MediaOverlayViewHelper({epubController:this.model})).renderFixedMoPlaying(this.pages.get("current_page"),this.mediaOverlayController.get("active_mo"),this)},highlightText:function(){(new Readium.Models.MediaOverlayViewHelper({epubController:this.model})).renderFixedLayoutMoFragHighlight(this.pages.get("current_page"),this.mediaOverlayController.get("mo_text_id"),this)},destruct:function(){Readium.Views.PaginationViewBase.prototype.destruct.call(this);
this.model.off("change:two_up",this.setUpMode);this.model.off("change:meta_size",this.setUpMode)},spinePositionChangeHandler:function(){this.pages.goToPage(this.model.get("spine_position")+1)},addPage:function(a,c){var b=a.getPageView();b.on("iframe_loaded",function(){this.iframeLoadCallback({srcElement:b.iframe()})},this);var d=a.getPageView().render().el;$(d).attr("id","page-"+c.toString());this.$("#container").append(d);this.showCurrentPages();return this},setContainerSize:function(){var a=this.model.get("meta_size");
if(a&&(this.$el.width(a.width*2),this.$el.height(a.height),this.zoomer.fitToBest(),!this.zoomed))this.zoomed=!0},findPrerenderStart:function(){for(var a=0;this.shouldPreRender(this.model.getCurrentSection(a));)a-=1;return a+1},shouldPreRender:function(a){return a&&a.isFixedLayout()},showCurrentPages:function(){var a=this,c=new Readium.Models.MediaOverlayViewHelper({epubController:this.model});this.$(".fixed-page-wrap").each(function(b){$(this).toggle(a.pages.isPageVisible(b+1))});$.each(this.pages.get("current_page"),
function(){c.removeActiveClass(a.getPageBody(this.toString()))})},setFontSize:function(){var a=this.model.get("font_size")/10;$("#readium-content-container").css("font-size",a+"em");this.showCurrentPages()}});
Readium.Views.FixedPageView=Backbone.View.extend({className:"fixed-page-wrap",initialize:function(){this.template=Handlebars.templates.fixed_page_template;this.model.on("change",this.render,this)},destruct:function(){this.model.off("change",this.render)},render:function(){var a=this;this.$el.html(this.template(this.model.toJSON()));this.$el.addClass(this.model.getPageSpreadClass());this.$(".content-sandbox").on("load",function(){a.trigger("iframe_loaded")});return this},iframe:function(){return this.$(".content-sandbox")[0]}});
Readium.Views.ImagePageView=Backbone.View.extend({className:"fixed-page-wrap",initialize:function(){this.template=Handlebars.templates.image_page_template;this.model.on("change",this.render,this)},render:function(){var a=this;this.$el.html(this.template(this.model.toJSON()));this.$el.addClass(this.model.getPageSpreadClass());this.$("img").on("load",function(){a.setSize()});return this},setSize:function(){var a=this.$("img"),c=a.width(),a=a.height();c>0&&this.model.set({meta_width:c,meta_height:a})}});
